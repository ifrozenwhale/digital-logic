# 存储器设计

## 目标

1. 利用BASYS3片内存储器单元实现单端口RAM设计(带异步读和同步读两种模式)，在时钟(clk). 上升沿，采集地址(addr) 、输入数据(data in)、执行相关控制信息。当写使能(we) 有效，则执行写操作，否则执行读取操作。同步与异步设计仅针对读操作:对于异步RAM而言，读操作为异步，即地址信号有效时，控制器直接读取RAM阵列;对于同步RAM而言，地址信号在时钟上升沿被采集。并保存在寄存器中，然后使用该地址信号读取RAM阵列。
2. 实现双端口(同步与异步) RAM设计，相对于单端口RAM而言，双端口RAM存在两个存取端口，并且可独立进行读写操作，具有自己的地址( addr_ _a、addr_ b)、数据输入(din_ a、din_ b) /输出端口(dout_ a、dout_ b)。
3. 实现FIFO设计，FIFO由存储单元队列或阵列构成，和RAM不同的是FIFO没有地址，第一-个被写入队列的数据也是第一个从队列中读出的数据。FIFO可以在输入输出速率不匹配时，作为临时存储单元;可用于不同时钟域中间的同步;输入数据路径和输出数据路径之间数据宽度不匹配时，可用于数据宽度调整电路。

## 设计

### 单端口RAM

#### 单口RAM（同步读，同步写）

只有一个端口，一个地址，要么读，要么写。 

同步读指的是在时钟信号上升沿进行读。 

#### 单口RAM（异步读，同步写）

异步读，这里指给出地址的时候就进行读，即时钟不同步

### 双端口RAM

#### 双口RAM（同步读，同步写）

**概述**

1. 双口RAM，这里实现的是真双口RAM，即每个端口有独立的地址，可以完全独立地进行读写。
2. 例如，同时在端口AB进行写入，或者同时在端口AB进行读取。应当避免两个读端口或者两个写端口同时操作同一个地址，RAM中并没有此种冲突解决电路，设计者应该避免这种冲突。
3. 在FPGA上实现的时候，由于无法在内置时钟的条件下并行输入多位的数据，因此使用按键，来加载信号，然后按照时钟的时序逻辑来处理同步和异步。

**实现** 

1. 顶层模块集成了数码管显示和双端口RAM的顶层模块。数码管显示用于方便测试地址（避免出现同时操作同一地址的情况）。
2. 双口RAM的顶层模块集成了时钟分频模块，按键消抖模块以及双口RAM模块。由于下载到FPGA开发板上，需要输入数据，而数据有一定的宽度，因此需要同时加载n位宽度的数据。考虑使用按键来完成，而按键需要进行消抖以保障正常功能。
3. 双口RAM的核心模块实现了两个端口独立的读与写，但是并未对同时操作同一地址的情况作出限制，使用时候应避免这种情况。写操作在时钟上边沿到达时进行，根据写使能触发，而读操作也在时钟上边沿到达时，根据读使能触发。

#### 双口RAM（异步读，同步写）

1. 实现时，与同步读的双口RAM相似。读写分离，读操作的触发条件不再是时钟信号，而是地址信号。在地址给出的时，减小读操作。

### FIFO

1. **读写指针的设置**

   分别为读和写设置三个指针：

   当前读位置的指针、下一个状态即将读的位置的指针和指向下一个读的地址的指针；

   当前写位置的指针、下一个状态即将写的位置的指针和指向下一个写的地址的指针。

2. **读命令**

   在读命令下，如果队列不为空，将当前读指针的下一个指针赋值给读指针的下一个状态，同时将队列的满标志置0。然后判断读指针的下一个指针是否和写指针的值一样。一样的话，说明队列为空；否则不为空。

3. **写命令**

   在数据的上升沿的时候，有写使能信号，就将数据写入

   在写命令下，如果队列不为满，将当前写指针的下一个指针赋值给读指针的下一个状态，同时将队列的空标志置0。然后判断写指针的下一个指针是否和读指针的值一样。一样的话，说明队列为满；否则不为满。

4. **状态跳转**

   复位信号有效(rst_n = 0)，读/写指针都指向0地址。此时队列状态为空。

   复位不有效，且在时钟的上升沿，读/写指针的值，队列空，满状态的值由下一状态决定。否则保持原状态。

   当队列不满且输入写使能信号的时候，数据写入信号为1。